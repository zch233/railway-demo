import{r as v,u as w}from"./ef14c475.js";import{Q as y,h as S,d as s,j as f,b3 as A,b0 as n,l as C}from"./2f07c074.js";import{u as Y,_ as c}from"./1007c9c8.js";import{I as _}from"./d206b931.js";const B=y({name:"ModalImport",emits:["updateColumns","updateDataSource","updatePlaces","updateWays","success","updatePlatforms"],expose:["showModal"],setup($,l){const D=Y(),t=S({visible:!1,loading:!1,formData:{file:[],clear:"0"}}),g=()=>{const o=t.formData.file[0],i=new FileReader;i.onload=h=>{const M=new Uint8Array(h.target.result),m=v(M,{cellDates:!0}),d=w.sheet_to_json(m.Sheets[m.SheetNames[0]],{header:1,range:1});l.emit("updateColumns",d[0].map((e,a)=>({key:a,title:e})));const r=d.slice(1).filter(e=>e.length).map(e=>{const a=e.reduce((p,u,b)=>(p[b]=typeof u=="object"?n(u).format("HH:mm"):u,p),{});return a.status="1",a}).sort((e,a)=>new Date(`${n().format("YYYY-MM-DD")} ${e[4]==="="?e[5]:e[4]}`).getTime()-new Date(`${n().format("YYYY-MM-DD")} ${a[4]==="="?a[5]:a[4]}`).getTime());l.emit("updateDataSource",{list:r,total:r.length}),l.emit("updatePlaces",[...new Set(r.map(e=>e[1]))]),l.emit("updatePlatforms",[...new Set(r.map(e=>e[6]))]),l.emit("updatePlatformsRules",r.reduce((e,a)=>(e[a[1]]=[...new Set(e[a[1]])],e[a[1]].push(a[6]),e),{})),l.emit("updateWays",[...new Set(r.map(e=>e[7]))]),l.emit("success"),t.visible=!1,C.success("\u5BFC\u5165\u6210\u529F")},i.readAsArrayBuffer(o),t.formData.clear==="1"&&D.setOrderList([])};return{Modal:()=>s(A,{visible:t.visible,"onUpdate:value":o=>t.visible=o,onOk:g,onCancel:()=>t.visible=!1,confirmLoading:t.loading,title:"\u5BFC\u5165"},{default:()=>[s(c,{labelCol:{span:0},formData:t.formData,item:{key:"file",type:"upload.dragger",props:{customRequest:o=>t.formData.file=[o.file],uploadContent:()=>s("div",null,[s("p",{class:"ant-upload-drag-icon"},[s(_,null,null)]),s("p",{class:"ant-upload-text"},[f("\u5355\u51FB\u6216\u5C06\u6587\u4EF6\u62D6\u52A8\u5230\u6B64\u533A\u57DF\u4EE5\u4E0A\u4F20")]),s("p",{class:"ant-upload-hint"},[f("\u6587\u4EF6\u63D0\u793A")])]),name:"file"}}},null),s(c,{labelCol:{span:0},formData:t.formData,"onUpdate:formData":o=>t.formData.clear=o.clear,item:{key:"clear",label:"\u662F\u5426\u6E05\u7A7A\u8C03\u4EE4",type:"radio",props:{options:[{label:"\u662F\u7684\uFF0C\u6211\u8981\u6E05\u7A7A",value:"1"},{label:"\u522B\uFF0C\u6211\u6682\u65F6\u4E0D\u60F3",value:"0"}]}}},null)]}),showModal:()=>t.visible=!0}},render(){return this.Modal()}});export{B as _};
